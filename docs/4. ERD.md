# 4. ERD

> Menggunakan ChartDB -DBML/Json

```json
Table "mst_vendor_category" {
  "vendor_category_id" int [pk, not null, increment]
  "category_name" varchar(255) [unique, not null, note: 'e.g., Chemical, BBM, Sparepart & Tool']
  "category_code" varchar(50) [unique, not null]
  "description" text
  "is_active" boolean [not null, default: `true`]
  "created_at" datetime [not null, default: `CURRENT_TIMESTAMP`]
  "updated_at" datetime [not null, default: `CURRENT_TIMESTAMP`]

  Indexes {
    category_code [unique, name: "idx_mst_vendor_category_category_code"]
  }

  Note: 'Master kategori vendor untuk mengklasifikasikan vendor'
}

Table "mst_vendor" {
  "vendor_id" int [pk, not null, increment]
  "vendor_code" varchar(100) [unique, not null, note: 'External Vendor ID from sync']
  "company_name" varchar(500) [not null]
  "vendor_category_id" int [not null, ref: < "mst_vendor_category"."vendor_category_id"]
  "is_active" boolean [not null, default: `true`]
  "last_sync_time" datetime
  "sync_source" varchar(100) [note: 'External system source']
  "created_at" datetime [not null, default: `CURRENT_TIMESTAMP`]
  "updated_at" datetime [not null, default: `CURRENT_TIMESTAMP`]

  Indexes {
    vendor_code [unique, name: "idx_mst_vendor_vendor_code"]
    (vendor_category_id, is_active) [name: "idx_mst_vendor_category_active"]
  }

  Note: 'Master data vendor dari sistem eksternal dengan kategori yang dikelola internal. FR-13'
}

Table "mst_checklist_category" {
  "checklist_category_id" int [pk, not null, increment]
  "category_name" varchar(255) [unique, not null, note: 'Safety, Quality, Productivity, Environment']
  "category_code" varchar(50) [unique, not null]
  "display_order" int [not null]
  "icon_name" varchar(100) [note: 'Lucide icon name']
  "color_code" varchar(50) [note: 'Tailwind color class']
  "description" text
  "is_active" boolean [not null, default: `true`]
  "created_at" datetime [not null, default: `CURRENT_TIMESTAMP`]
  "updated_at" datetime [not null, default: `CURRENT_TIMESTAMP`]

  Indexes {
    (is_active, display_order) [name: "idx_mst_checklist_category_active_order"]
  }

  Note: 'Kategori checklist: Safety, Quality, Productivity, Environment. FR-14'
}

Table "mst_checklist_item" {
  "checklist_item_id" int [pk, not null, increment]
  "checklist_category_id" int [not null, ref: < "mst_checklist_category"."checklist_category_id"]
  "item_code" varchar(100) [unique, not null]
  "item_text" text [not null, note: 'Pertanyaan checklist']
  "item_type" varchar(50) [not null, note: 'UMUM atau KHUSUS']
  "vendor_category_id" int [note: 'NULL untuk UMUM, ada value untuk KHUSUS', ref: < "mst_vendor_category"."vendor_category_id"]
  "display_order" int [not null]
  "is_required" boolean [not null, default: `true`]
  "is_active" boolean [not null, default: `true`]
  "created_at" datetime [not null, default: `CURRENT_TIMESTAMP`]
  "updated_at" datetime [not null, default: `CURRENT_TIMESTAMP`]

  Indexes {
    item_code [unique, name: "idx_mst_checklist_item_item_code"]
    (checklist_category_id, is_active, display_order) [name: "idx_mst_checklist_item_category_active_order"]
    (item_type, vendor_category_id, is_active) [name: "idx_mst_checklist_item_type_vendor_active"]
  }

  Note: 'Item checklist UMUM dan KHUSUS per kategori vendor. FR-14, NFR-O1: mereplikasi checklist manual'
}

Table "mst_user" {
  "user_id" int [pk, not null, increment]
  "external_user_id" varchar(255) [unique, not null, note: 'User ID dari JWT eksternal']
  "username" varchar(255) [not null]
  "full_name" varchar(500) [not null]
  "role" varchar(50) [not null, note: 'Warehouse Staff, Group Leader, Section Head, Admin']
  "last_login" datetime
  "is_active" boolean [not null, default: `true`]
  "created_at" datetime [not null, default: `CURRENT_TIMESTAMP`]
  "updated_at" datetime [not null, default: `CURRENT_TIMESTAMP`]

  Indexes {
    external_user_id [unique, name: "idx_mst_user_external_user_id"]
  }

  Note: 'Data user dari JWT eksternal untuk audit dan tampilan. FR-07: Role-based access'
}

Table "ops_checkin_entry" {
  "entry_id" int [pk, not null, increment, ref: < "ops_queue_status"."entry_id", ref: < "ops_timelog"."entry_id", ref: < "ops_verification"."entry_id"]
  "queue_number" varchar(50) [unique, not null, note: 'Format: YYYYMMDD-XXX']
  "vendor_id" int [not null, ref: < "mst_vendor"."vendor_id"]
  "driver_name" varchar(500) [not null]
  "snapshot_vendor_category_id" int [not null, note: 'Snapshot kategori vendor saat check-in', ref: < "mst_vendor_category"."vendor_category_id"]
  "snapshot_company_name" varchar(500) [not null, note: 'Snapshot nama perusahaan']
  "snapshot_category_name" varchar(255) [not null, note: 'Snapshot nama kategori']
  "submission_time" datetime [not null, default: `CURRENT_TIMESTAMP`]
  "current_status" varchar(50) [not null, default: `MENUNGGU`, note: 'MENUNGGU/DISETUJUI/DITOLAK/SELESAI']
  "device_identifier" varchar(255)
  "ip_address" varchar(50)
  "has_non_compliant_items" boolean [not null, default: `false`]
  "non_compliant_count" int [not null, default: 0]
  "created_at" datetime [not null, default: `CURRENT_TIMESTAMP`]
  "updated_at" datetime [not null, default: `CURRENT_TIMESTAMP`]

  Indexes {
    queue_number [unique, name: "idx_ops_checkin_entry_queue_number"]
    (current_status, submission_time) [name: "idx_ops_checkin_entry_status_time"]
    (submission_time, vendor_id) [name: "idx_ops_checkin_entry_time_vendor"]
    has_non_compliant_items [name: "idx_ops_checkin_entry_non_compliant"]
  }

  Note: 'Entri check-in vendor. FR-04: Generate nomor antrean & status. NFR-P2: Support 500K+ records'
}

Table "ops_checkin_response" {
  "response_id" int [pk, not null, increment]
  "entry_id" int [not null, ref: < "ops_checkin_entry"."entry_id"]
  "checklist_item_id" int [not null, ref: < "mst_checklist_item"."checklist_item_id"]
  "checklist_category_id" int [not null, ref: < "mst_checklist_category"."checklist_category_id"]
  "item_text_snapshot" text [not null, note: 'Snapshot pertanyaan saat dijawab']
  "item_type" varchar(50) [not null, note: 'UMUM/KHUSUS']
  "response_value" boolean [not null, note: 'TRUE = YA, FALSE = TIDAK']
  "is_compliant" boolean [not null, note: 'Inverse dari response jika pertanyaan safety-critical']
  "display_order" int [not null]
  "created_at" datetime [not null, default: `CURRENT_TIMESTAMP`]

  Indexes {
    entry_id [name: "idx_ops_checkin_response_entry_id"]
    (entry_id, is_compliant) [name: "idx_ops_checkin_response_entry_compliant"]
  }

  Note: 'Jawaban checklist per item. FR-03: Dynamic checklist dengan progress tracking'
}

Table "ops_verification" {
  "verification_id" int [pk, not null, increment]
  "entry_id" int [unique, not null]
  "verified_by_user_id" int [not null, ref: < "mst_user"."user_id"]
  "verification_status" varchar(50) [not null, note: 'DISETUJUI/DITOLAK']
  "rejection_reason" text [note: 'Wajib diisi jika REJECTED']
  "verification_time" datetime [not null, default: `CURRENT_TIMESTAMP`]
  "created_at" datetime [not null, default: `CURRENT_TIMESTAMP`]

  Indexes {
    entry_id [unique, name: "idx_ops_verification_entry_id"]
    (verification_time, verification_status) [name: "idx_ops_verification_time_status"]
  }

  Note: 'Hasil verifikasi oleh Petugas. FR-09: Approved/Rejected dengan alasan. NFR-O2: Audit trail'
}

Table "ops_timelog" {
  "timelog_id" int [pk, not null, increment]
  "entry_id" int [unique, not null]
  "checkin_time" datetime [note: 'Diisi saat status APPROVED']
  "checkout_time" datetime [note: 'Diisi sekali saat Check-Out']
  "checkout_by_user_id" int [ref: < "mst_user"."user_id"]
  "duration_minutes" int [note: 'Calculated: checkout_time - checkin_time']
  "is_checked_out" boolean [not null, default: `false`]
  "created_at" datetime [not null, default: `CURRENT_TIMESTAMP`]
  "updated_at" datetime [not null, default: `CURRENT_TIMESTAMP`]

  Indexes {
    entry_id [unique, name: "idx_ops_timelog_entry_id"]
    (is_checked_out, checkin_time) [name: "idx_ops_timelog_checkout_time"]
  }

  Note: 'Log waktu check-in dan check-out. FR-10: Check-Out sekali saja, durasi real-time'
}

Table "ops_queue_status" {
  "queue_status_id" int [pk, not null, increment]
  "entry_id" int [unique, not null]
  "queue_number" varchar(50) [not null]
  "current_status" varchar(50) [not null]
  "status_display_text" varchar(255) [not null, note: 'Text untuk display publik']
  "priority_order" int [note: 'Untuk sorting di TV Display']
  "estimated_wait_minutes" int [note: 'Future: estimasi waktu tunggu']
  "last_updated" datetime [not null, default: `CURRENT_TIMESTAMP`]

  Indexes {
    entry_id [unique, name: "idx_ops_queue_status_entry_id"]
    (current_status, priority_order) [name: "idx_ops_queue_status_display"]
  }

  Note: 'Status antrean real-time untuk dashboard dan TV Display. FR-06: Auto-refresh'
}

Table "log_audit" {
  "audit_id" int [pk, not null, increment]
  "entry_id" int [ref: < "ops_checkin_entry"."entry_id"]
  "user_id" int [ref: < "mst_user"."user_id"]
  "action_type" varchar(100) [not null, note: 'CHECKIN/VERIFY/APPROVE/REJECT/CHECKOUT/SYNC']
  "action_description" text [not null]
  "old_value" text [note: 'JSON snapshot sebelum perubahan']
  "new_value" text [note: 'JSON snapshot setelah perubahan']
  "ip_address" varchar(50)
  "user_agent" varchar(500)
  "created_at" datetime [not null, default: `CURRENT_TIMESTAMP`]

  Indexes {
    (created_at, action_type) [name: "idx_log_audit_time_action"]
    entry_id [name: "idx_log_audit_entry_id"]
  }

  Note: 'Log audit untuk semua aktivitas. NFR-O2: Audit trail minimal 1 tahun'
}

Table "log_report_export" {
  "export_id" int [pk, not null, increment]
  "exported_by_user_id" int [not null, ref: < "mst_user"."user_id"]
  "report_type" varchar(100) [not null, note: 'DAILY/CUSTOM/COMPLIANCE']
  "date_from" date [not null]
  "date_to" date [not null]
  "filter_criteria" text [note: 'JSON filter yang digunakan']
  "total_records" int [not null]
  "file_name" varchar(500) [not null]
  "file_path" varchar(1000)
  "export_time" datetime [not null, default: `CURRENT_TIMESTAMP`]

  Indexes {
    (export_time, report_type) [name: "idx_log_report_export_time_type"]
  }

  Note: 'Log export report. FR-12: Export XLSX 4 sheet'
}

Table "cfg_system" {
  "config_id" int [pk, not null, increment]
  "config_key" varchar(255) [unique, not null]
  "config_value" text [not null]
  "config_type" varchar(50) [not null, note: 'STRING/INT/BOOLEAN/JSON']
  "description" text
  "is_editable" boolean [not null, default: `true`]
  "updated_by_user_id" int [ref: < "mst_user"."user_id"]
  "created_at" datetime [not null, default: `CURRENT_TIMESTAMP`]
  "updated_at" datetime [not null, default: `CURRENT_TIMESTAMP`]

  Indexes {
    config_key [unique, name: "idx_cfg_system_config_key"]
  }

  Note: 'Konfigurasi sistem: auto-refresh interval, queue format, etc.'
}

```
